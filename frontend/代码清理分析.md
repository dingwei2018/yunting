# Sentences.vue 无用代码分析

## 一、可以完全删除的代码（已迁移到 SentenceEditor 组件）

### 1. 编辑相关的状态变量（已迁移到 useSentenceEditorState）

以下状态现在在 `SentenceEditor` 组件内部管理，可以删除：

```javascript
// ❌ 可以删除
const editingForm = reactive({ ... })  // 行 281-288
const editorRefs = reactive({})  // 行 300
const pauseEligibilityMap = reactive({})  // 行 301
const selectionStateMap = reactive({})  // 行 302
const polyphonicModeMap = reactive({})  // 行 303
const polyphonicStateMap = reactive({})  // 行 304
const polyphonicTooltip = reactive({ ... })  // 行 305-313
let polyphonicTooltipTimer = null  // 行 314
const isTooltipHovering = ref(false)  // 行 315
const localSpeedDialog = reactive({ ... })  // 行 793-800
const splitStandardDialogVisible = ref(false)  // 行 247
const splitStandardType = ref('punctuation')  // 行 245
const splitStandardCharCount = ref(50)  // 行 246
const splitStandardContext = ref(null)  // 行 248
```

### 2. 编辑相关的函数（已迁移到各个 composables）

#### 2.1 基础编辑函数（已迁移到 useSentenceEditorState）
```javascript
// ❌ 可以删除
const selectSubSentence = (sub) => { ... }  // 行 748-758
const setEditorRef = (id, instance) => { ... }  // 行 760-766
const handleEditorSelectionChange = (sub, payload) => { ... }  // 行 768-774
const handleEditorContentChange = (sub) => { ... }  // 行 776-779
const handleEditorFocus = (sub) => { ... }  // 行 781-786
const currentSelectionContext = computed(() => { ... })  // 行 788-791
```

#### 2.2 多音字相关函数（已迁移到 useSentenceEditorPolyphonic）
```javascript
// ❌ 可以删除
const ensurePolyphonicState = (sentenceId) => { ... }  // 行 670-682
const getPolyphonicMarkers = (sub) => { ... }  // 行 684-687
const isPolyphonicModeActive = (sub) => { ... }  // 行 689-692
const buildPolyphonicMarkers = (sub) => { ... }  // 行 694-738
const refreshPolyphonicForSub = (sub) => { ... }  // 行 740-744
const togglePolyphonicMode = () => { ... }  // 行 3048-3057
const handlePolyphonicHover = (sub, payload) => { ... }  // 行 2998-3021
const handlePolyphonicOptionSelect = (option) => { ... }  // 行 3033-3046
const handleTooltipMouseEnter = () => { ... }  // 行 3023-3026
const handleTooltipMouseLeave = () => { ... }  // 行 3028-3031
const hidePolyphonicTooltip = () => { ... }  // 行 2960-2969
const showPolyphonicTooltip = (marker, rect) => { ... }  // 行 2981-2996
const scheduleTooltipHide = () => { ... }  // 行 2971-2979
const cancelTooltipHide = () => { ... }  // 行 2953-2958
```

#### 2.3 局部语速相关函数（已迁移到 useSentenceEditorSpeed）
```javascript
// ❌ 可以删除
const handleRequestLocalSpeed = (context) => { ... }  // 行 802-812
const handleCancelLocalSpeed = () => { ... }  // 行 814-820
const handleConfirmLocalSpeed = () => { ... }  // 行 822-835
const handleSpeedSegmentsChange = ({ sub, segments }) => { ... }  // 行 837-840
```

#### 2.4 停顿和静音相关函数（已迁移到 useSentenceEditorSplit）
```javascript
// ❌ 可以删除
const insertPauseMarker = () => { ... }  // 行 3059-3066
const insertSilenceMarker = (duration) => { ... }  // 行 3068-3075
const promptSilenceDuration = async () => { ... }  // 行 3077-3099
```

#### 2.5 断句操作相关函数（已迁移到 useSentenceEditorSplit）
```javascript
// ❌ 可以删除
const handleSplitStandard = () => { ... }  // 行 3101-3124
const handleSplitStandardDialogClose = () => { ... }  // 行 3126-3132
const handleSplitStandardConfirm = () => { ... }  // 行 3134-3161
const handleSplitByPunctuation = async (rootSentence, originalText) => { ... }  // 行 3164-3180
const handleSplitByCharCount = async (rootSentence, originalText, charCount) => { ... }  // 行 3182-3204
const handleCustomAction = (actionKey) => { ... }  // 行 3206-3219
const handleClearText = async (rootSentence) => { ... }  // 行 842-897
const handleInsertAfter = async (sentenceId) => { ... }  // 行 2091-2122
const handleDelete = async (sentenceId) => { ... }  // 行 2016-2077
```

#### 2.6 合成和播放相关函数（部分已迁移）
```javascript
// ❌ 可以删除（断句相关的合成和播放）
const handleResynthesizeBreakingSentence = async (breakingSentenceId) => { ... }  // 行 2380-2406
const handleSynthesizeAllBreakingSentences = async () => { ... }  // 行 2463-2515
const handlePlay = (sentence) => { ... }  // 行 2531-2617
const getBreakingSentenceSynthesisStatus = (breakingSentenceId) => { ... }  // 行 2337-2377
const startPollingBreakingSentenceStatus = (breakingSentenceId) => { ... }  // 行 2408-2460

// ✅ 保留（拆句相关的合成和播放）
const handleResynthesizeOriginalSentence = async (originalSentenceId) => { ... }  // 保留
const handlePlayOriginalSentence = async (sentence) => { ... }  // 保留
const startPollingOriginalSentenceStatus = (originalSentenceId, showProgressDialog) => { ... }  // 保留
```

#### 2.7 保存相关函数（已迁移到 useSentenceEditorSave）
```javascript
// ❌ 可以删除
const handleSaveCurrent = async () => { ... }  // 行 1859-1993
const hasUnsavedChanges = () => { ... }  // 行 1637-1707（但需要检查是否还有其他地方使用）
```

#### 2.8 其他编辑相关函数
```javascript
// ❌ 可以删除
const loadSentenceDetail = async (sentenceId, fallbackContent) => { ... }  // 行 1743-1815（现在在 SentenceEditor 内部处理）
const selectVoice = (voice) => { ... }  // 行 1851-1853
const handleUpdateCategory = (value) => { ... }  // 行 1855-1857
const isClearingText = ref(false)  // 行 746
```

### 3. 模板中的组件（已迁移到 SentenceEditor）

```vue
<!-- ❌ 可以删除 -->
<PolyphonicTooltip ... />  <!-- 行 110-121 -->
<SplitStandardDialog ... />  <!-- 行 133-142 -->
<el-dialog v-model="localSpeedDialog.visible" ... />  <!-- 行 144-166 -->
```

### 4. 计算属性（已迁移）

```javascript
// ❌ 可以删除
const currentSubSentence = computed(() => ...)  // 行 347-349
const isPauseEnabled = computed(() => ...)  // 行 351-355
const customDisabledState = computed(() => ...)  // 行 357-359
const activeCustomActions = computed(() => ...)  // 行 361-365
```

### 5. Watch 监听器（已迁移）

```javascript
// ❌ 可以删除
watch(() => editingSubSentenceId.value, () => { ... })  // 行 898-912
watch(() => currentSubSentence.value && currentSubSentence.value.content, (val) => { ... })  // 行 914-922
watch(() => [editingForm.voice, editingForm.volume, editingForm.speed, editingForm.pitch], () => { ... })  // 行 924-940
watch(() => editingForm.volume, (val) => { ... })  // 行 942-950
watch(() => editingForm.speed, (val) => { ... })  // 行 952-960
```

### 6. 工具函数（已迁移）

```javascript
// ❌ 可以删除（这些函数已经在 composables 中）
const clampVolume = (value) => { ... }  // 行 290-293（在 useSentenceEditorState 中使用）
const clampSpeed = (value) => { ... }  // 行 295-298（在 useSentenceEditorState 中使用）
```

### 7. 不再需要的导入

```javascript
// ❌ 可以删除
import PolyphonicTooltip from '@/components/PolyphonicTooltip.vue'  // 如果模板中已删除
import SplitStandardDialog from '@/components/SplitStandardDialog.vue'  // 如果模板中已删除
```

## 二、需要保留但可能需要简化的代码

### 1. 编辑状态管理（简化）

```javascript
// ✅ 保留但简化
const editingSentenceId = ref(null)  // 保留，用于控制哪个拆句正在编辑
const editingSubSentenceId = ref(null)  // 可能还需要，但主要用于内部状态同步
const pendingSelectSubSentenceId = ref(null)  // 保留，用于状态恢复
```

### 2. 编辑生命周期函数（简化）

```javascript
// ✅ 保留但简化
const toggleEdit = async (sentence) => { ... }  // 保留，但可以简化逻辑
const closeEditing = async () => { ... }  // 保留，但可以简化逻辑
```

### 3. 数据获取和转换函数（保留）

```javascript
// ✅ 保留
const getOriginalSentenceData = (originalSentenceId) => { ... }  // 行 381-394，用于获取原始数据
const handleOriginalSentenceUpdate = (updatedSentence) => { ... }  // 行 397-413，处理更新
const handleEditorExpandedChange = (expanded) => { ... }  // 行 416-421，处理展开/收起
const handleEditorSaved = async () => { ... }  // 行 424-427，处理保存事件
const handleEditorRefresh = async () => { ... }  // 行 430-433，处理刷新事件
const getBreakingSentencesFromApi = (originalSentenceId) => { ... }  // 行 436-576，可能还需要用于其他用途
```

### 4. 拆句相关的合成和播放（保留）

```javascript
// ✅ 保留
const handleResynthesizeOriginalSentence = async (originalSentenceId) => { ... }
const handlePlayOriginalSentence = async (sentence) => { ... }
const startPollingOriginalSentenceStatus = (originalSentenceId, showProgressDialog) => { ... }
const getOriginalSentenceSynthesisStatus = (originalSentenceId) => { ... }
```

## 三、统计

### 可以删除的代码行数估算

- **状态变量**: ~50 行
- **函数定义**: ~800 行
- **计算属性**: ~20 行
- **Watch 监听器**: ~80 行
- **模板组件**: ~60 行
- **总计**: 约 **1010 行** 可以删除

### 当前文件总行数

- **总行数**: 3596 行
- **可删除**: ~1010 行
- **删除后**: ~2586 行
- **减少比例**: 约 **28%**

## 四、建议的清理步骤

1. **第一步**: 删除模板中的无用组件（PolyphonicTooltip, SplitStandardDialog, localSpeedDialog）
2. **第二步**: 删除已迁移的状态变量
3. **第三步**: 删除已迁移的函数
4. **第四步**: 删除已迁移的计算属性和 watch
5. **第五步**: 简化保留的函数（如 toggleEdit, closeEditing）
6. **第六步**: 测试确保功能正常

## 五、注意事项

1. **hasUnsavedChanges**: 需要检查是否还有其他地方使用，如果没有，可以删除
2. **getBreakingSentencesFromApi**: 需要确认是否还有其他地方使用，如果没有，可以删除
3. **loadSentenceDetail**: 需要确认是否还有其他地方使用，如果没有，可以删除
4. **editingSubSentenceId**: 可能还需要用于状态同步，需要确认

