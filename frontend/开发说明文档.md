# 北京云听音频精修系统 - 前端开发说明文档

## 一、项目背景

### 1.1 使用场景
- 本项目会被其他项目引用
- 第三方系统通过**弹框（Dialog/Modal）**方式嵌入显示，而非完整页面
- 需要支持跨域访问

### 1.2 核心约束
- ✅ 支持弹框模式显示
- ✅ 解决跨域问题
- ✅ 支持URL参数直接打开指定页面
- ✅ 响应式布局适配弹框尺寸

---

## 二、页面路由设计

### 2.1 路由结构

```
/                          # 测试页面（开发用）
/text-input                # 文本输入页面
/sentences?task_id={id}    # 自动拆句后结果页面（支持task_id参数）
/edit?task_id={id}&sentence_id={id}  # 精修页面（支持task_id和sentence_id参数）
```

### 2.2 URL参数说明

#### 自动拆句后结果页面
- **路由**: `/sentences`
- **参数**:
  - `task_id` (必填): 任务ID，用于加载任务和句子列表
- **示例**: `/sentences?task_id=123`

#### 精修页面
- **路由**: `/edit`
- **参数**:
  - `task_id` (必填): 任务ID
  - `sentence_id` (可选): 句子ID，如果提供则自动定位到该句子并高亮
- **示例**: 
  - `/edit?task_id=123` - 打开任务123的精修页面
  - `/edit?task_id=123&sentence_id=456` - 打开任务123的精修页面，并定位到句子456

---

## 三、测试页面设计

### 3.1 测试页面功能
在根路由 `/` 提供一个测试页面，包含：

1. **测试按钮组**:
   - "打开文本输入页面" - 打开文本输入弹框
   - "打开拆句结果页面" - 打开拆句结果弹框（需要输入task_id）
   - "打开精修页面" - 打开精修弹框（需要输入task_id，可选sentence_id）

2. **参数输入区域**:
   - task_id 输入框
   - sentence_id 输入框（可选）

3. **弹框预览区域**:
   - 显示当前打开的弹框内容

### 3.2 测试页面实现示例

```vue
<template>
  <div class="test-page">
    <h1>北京云听音频精修 - 测试页面</h1>
    
    <div class="test-controls">
      <el-input v-model="taskId" placeholder="任务ID" />
      <el-input v-model="sentenceId" placeholder="句子ID（可选）" />
      
      <el-button @click="openTextInput">打开文本输入页面</el-button>
      <el-button @click="openSentences">打开拆句结果页面</el-button>
      <el-button @click="openEdit">打开精修页面</el-button>
    </div>
    
    <!-- 弹框容器 -->
    <el-dialog v-model="dialogVisible" :title="dialogTitle" width="90%" :close-on-click-modal="false">
      <router-view />
    </el-dialog>
  </div>
</template>
```

---

## 四、弹框集成方案

### 4.1 弹框组件设计
- 使用 Element Plus 的 `el-dialog` 组件
- 弹框尺寸：宽度 90%，高度自适应
- 支持全屏模式（可选）
- 关闭按钮：右上角关闭按钮

### 4.2 路由模式
- 使用 Vue Router 的 Hash 模式（避免跨域问题）
- 弹框内路由独立管理
- 支持浏览器前进/后退

### 4.3 布局要求
- **最小宽度**: 1200px（精修页面需要）
- **最小高度**: 600px
- **响应式**: 支持小屏幕适配
- **滚动**: 内容区域可滚动，头部固定

---

## 五、跨域处理

### 5.1 前端跨域配置
- API请求使用代理（开发环境）
- 生产环境配置CORS
- 使用相对路径或环境变量配置API地址

### 5.2 第三方集成
- 提供独立的入口文件
- 支持通过 iframe 嵌入
- 支持 postMessage 通信（如需要）

---

## 六、技术栈要求

### 6.1 前端框架
- Vue.js 3.x
- Vue Router 4.x
- Element Plus
- Axios

### 6.2 开发规范
- 使用 TypeScript（推荐）
- 组件化开发
- 统一的API封装
- 错误处理机制

---

## 七、核心页面实现要求

### 7.1 文本输入页面 (`/text-input`)
- 文本输入框（支持1万字）
- 拆句规则选择
- 自动拆句按钮
- 拆句成功后跳转到 `/sentences?task_id={id}`

### 7.2 自动拆句后结果页面 (`/sentences`)
- 从URL参数获取 `task_id`
- 调用API获取任务和句子列表
- 显示句子列表
- 每个句子支持：编辑、删除、向下插入、重新合成、播放
- "合并音频"按钮
- 点击"编辑"跳转到 `/edit?task_id={id}&sentence_id={id}`

### 7.3 精修页面 (`/edit`)
- 从URL参数获取 `task_id` 和 `sentence_id`
- 左侧：音色选择、参数调整（音量、语速）
- 中间：句子列表、编辑区域
- 右侧：功能按钮（断句标准、停顿、多音字等）
- 如果提供 `sentence_id`，自动定位并高亮该句子

---

## 八、API集成

### 8.1 API基础配置
```javascript
// api/config.js
const API_BASE_URL = process.env.VUE_APP_API_BASE_URL || '/api/v1'

export default {
  baseURL: API_BASE_URL,
  timeout: 30000
}
```

### 8.2 关键API调用
- `POST /tasks` - 创建任务并拆句
- `GET /tasks?task_id={id}` - 获取任务详情
- `GET /tasks/sentences?task_id={id}` - 获取句子列表
- `GET /sentences?sentence_id={id}` - 获取句子详情
- `POST /sentences/{id}/synthesize` - 合成音频
- `POST /tasks/{id}/audio/merge` - 合并音频

---

## 九、开发检查清单

### 9.1 功能检查
- [ ] 测试页面可以正常打开各个弹框
- [ ] URL参数可以正确传递和解析
- [ ] 弹框内路由跳转正常
- [ ] 跨域请求正常
- [ ] 响应式布局适配弹框

### 9.2 交互检查
- [ ] 文本输入页面可以创建任务
- [ ] 拆句结果页面可以显示句子列表
- [ ] 精修页面可以编辑句子
- [ ] 所有操作按钮功能正常
- [ ] 音频播放功能正常

### 9.3 兼容性检查
- [ ] 支持主流浏览器（Chrome、Firefox、Safari、Edge）
- [ ] 移动端适配（可选）
- [ ] 弹框在不同尺寸下显示正常

---

## 十、部署说明

### 10.1 构建配置
- 使用 Vue CLI 或 Vite 构建
- 输出静态文件到 `dist` 目录
- 配置环境变量（API地址等）

### 10.2 第三方集成方式
1. **方式一：iframe嵌入**
   ```html
   <iframe src="https://your-domain.com/#/sentences?task_id=123" />
   ```

2. **方式二：弹框组件**
   ```javascript
   // 第三方系统调用
   openDialog('/sentences?task_id=123')
   ```

---

## 十一、参考文档

- [原型交互分析](../原型/云听/原型交互分析.md)
- [API接口设计](../backend/api_design.md)
- [数据库设计](../backend/data_design.md)

---

**文档版本**: v1.0  
**最后更新**: 2024年

