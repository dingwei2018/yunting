# 应用配置
spring.application.name=yunting-backend
server.port=8080

# Tomcat URL 验证配置 - 允许在请求参数中使用方括号等特殊字符
# 解决 "The valid characters are defined in RFC 7230 and RFC 3986" 错误
# 允许在查询字符串中使用方括号，用于传递 JSON 数组字符串
server.tomcat.relaxed-query-chars=[,]
server.tomcat.relaxed-path-chars=[,]

# 日志配置（logback-spring.xml 会覆盖部分配置）
# 日志文件路径（可通过环境变量 LOG_HOME 覆盖）
logging.file.path=${LOG_HOME:logs}
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n

# Actuator 配置
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized

# 数据源配置（默认值可被环境变量覆盖）
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:mysql://rm-bp1r0053n0bcd4pmlim.mysql.rds.aliyuncs.com/yunting?characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Shanghai}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:root}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:SAAS_gaijin@2019}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# HikariCP 连接池配置（针对 2核8G 服务器优化）
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.validation-timeout=3000
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.leak-detection-threshold=60000

# JPA 配置
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect

# 华为云 SDK 配置
huaweicloud.ak=${HUAWEICLOUD_SDK_AK:HPUALDRLSKCBQCNAF0GN}
huaweicloud.sk=${HUAWEICLOUD_SDK_SK:qR5ckRAhYXBenKk13YB0ZTYIZ0C48Eh5YtdgGRcF}
huaweicloud.region=${HUAWEICLOUD_SDK_REGION:cn-north-4}
huaweicloud.project-id=${HUAWEICLOUD_SDK_PROJECT_ID:802c7a2a349347e1807438789c839bb7}

# 华为云 OBS 配置
huaweicloud.obs.endpoint=${HUAWEICLOUD_OBS_ENDPOINT:https://obs.cn-north-4.myhuaweicloud.com}
huaweicloud.obs.bucket=${HUAWEICLOUD_OBS_BUCKET:yunting-9bcc}
huaweicloud.obs.prefix=${HUAWEICLOUD_OBS_PREFIX:audio/}

# 应用回调URL配置
# TTS异步任务回调地址（必须是完整的绝对路径，包含协议、域名和路径）
# 例如: https://your-domain.com/api/synthesis/callback
app.callback.url=${APP_CALLBACK_URL:http://123.60.64.142:8080/api/synthesis/callback}

# 本地文件存储配置
file.storage.local.path=${FILE_STORAGE_LOCAL_PATH:temp/audio}

# FFmpeg 配置
# FFmpeg 可执行文件路径（如果 FFmpeg 在系统 PATH 中，可以直接使用 "ffmpeg"）
ffmpeg.path=${FFMPEG_PATH:ffmpeg}
# FFprobe 可执行文件路径（如果 FFprobe 在系统 PATH 中，可以直接使用 "ffprobe"）
ffprobe.path=${FFPROBE_PATH:ffprobe}
# FFmpeg 命令执行超时时间（毫秒），默认5分钟
ffmpeg.timeout=${FFMPEG_TIMEOUT:300000}

# MyBatis 配置
mybatis.mapper-locations=classpath*:mapper/*.xml
mybatis.configuration.map-underscore-to-camel-case=true

# 禁用 MongoDB 监控
management.metrics.mongo.enabled=false
spring.autoconfigure.exclude=org.springframework.boot.actuate.autoconfigure.metrics.mongo.MongoMetricsAutoConfiguration

## RocketMQ 配置
rocketmq.proxy-endpoint=${ROCKETMQ_PROXY_ENDPOINT:localhost:8081}

# TTS Topic（共用，用于 TTS_CALLBACK 和 TTS_SYNTHESIS 两种消息类型）
# 注意：如果使用顺序消息，需要确保该Topic支持FIFO消息类型
rocketmq.tts.topic=${ROCKETMQ_TTS_TOPIC:YunTingTopic}

# TTS回调消息Consumer Group
rocketmq.tts-callback.consumer-group=${ROCKETMQ_TTS_CALLBACK_CONSUMER_GROUP:TtsCallbackConsumerGroup}

# TTS回调消息顺序消息组（所有消息使用同一个消息组，确保全局顺序执行）
rocketmq.tts-callback.message-group=${ROCKETMQ_TTS_CALLBACK_MESSAGE_GROUP:TTS_CALLBACK_ORDERED}

# TTS合成请求Consumer Group
rocketmq.tts-synthesis.consumer-group=${ROCKETMQ_TTS_SYNTHESIS_CONSUMER_GROUP:TtsSynthesisConsumerGroup}

# TTS合成请求顺序消息组（所有消息使用同一个消息组，确保全局顺序执行）
rocketmq.tts-synthesis.message-group=${ROCKETMQ_TTS_SYNTHESIS_MESSAGE_GROUP:TTS_SYNTHESIS_ORDERED}

# 音频合并消息Consumer Group
rocketmq.audio-merge.consumer-group=${ROCKETMQ_AUDIO_MERGE_CONSUMER_GROUP:AudioMergeConsumerGroup}

# 音频合并消息并发处理数（默认3，因为音频合并比较耗时）
rocketmq.audio-merge.consumption-thread-count=${ROCKETMQ_AUDIO_MERGE_CONSUMPTION_THREAD_COUNT:3}

# 华为云自定义读法规则更新配置
# 华为云自定义读法规则更新超时时间（秒）
huaweicloud.vocabulary.update.timeout=${HUAWEICLOUD_VOCABULARY_UPDATE_TIMEOUT:30}
# 华为云自定义读法规则组ID，必须在华为云上设置好，并把voice_configs表里的音色放入组内，不然读法配置无法生效
huaweicloud.vocabulary.group-id=${HUAWEICLOUD_VOCABULARY_GROUP_ID:2c9084d59ac09773019b0d2662021381}

# 等待进行中TTS任务的最大时间（秒）
tts.wait.processing.tasks.timeout=${TTS_WAIT_PROCESSING_TASKS_TIMEOUT:30}

# 等待进行中TTS任务的轮询间隔（秒）
tts.wait.processing.tasks.poll.interval=${TTS_WAIT_PROCESSING_TASKS_POLL_INTERVAL:1}