# 应用配置
spring.application.name=yunting-backend
server.port=8080

# Tomcat URL 验证配置 - 允许在请求参数中使用方括号等特殊字符
# 解决 "The valid characters are defined in RFC 7230 and RFC 3986" 错误
# 允许在查询字符串中使用方括号，用于传递 JSON 数组字符串
server.tomcat.relaxed-query-chars=[,]
server.tomcat.relaxed-path-chars=[,]

# 日志配置（logback-spring.xml 会覆盖部分配置）
# 日志文件路径（可通过环境变量 LOG_HOME 覆盖）
logging.file.path=${LOG_HOME:logs}
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n

# Actuator 配置
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized

# 数据源配置（默认值可被环境变量覆盖）
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:mysql://123.60.64.142:3306/yunting?characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Shanghai}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:yunting}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:yunting}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# HikariCP 连接池配置（针对 2核8G 服务器优化）
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.validation-timeout=3000
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.leak-detection-threshold=60000

# JPA 配置
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect

# 华为云 SDK 配置
huaweicloud.ak=${HUAWEICLOUD_SDK_AK:HPUALDRLSKCBQCNAF0GN}
huaweicloud.sk=${HUAWEICLOUD_SDK_SK:qR5ckRAhYXBenKk13YB0ZTYIZ0C48Eh5YtdgGRcF}
huaweicloud.region=${HUAWEICLOUD_SDK_REGION:cn-north-4}
huaweicloud.project-id=${HUAWEICLOUD_SDK_PROJECT_ID:802c7a2a349347e1807438789c839bb7}

# 华为云 OBS 配置
huaweicloud.obs.endpoint=${HUAWEICLOUD_OBS_ENDPOINT:https://obs.cn-north-4.myhuaweicloud.com}
huaweicloud.obs.bucket=${HUAWEICLOUD_OBS_BUCKET:yunting-9bcc}
huaweicloud.obs.prefix=${HUAWEICLOUD_OBS_PREFIX:audio/}

# 应用回调URL配置
# TTS异步任务回调地址（必须是完整的绝对路径，包含协议、域名和路径）
# 例如: https://your-domain.com/api/synthesis/callback
# 或: http://localhost:8080/api/synthesis/callback
app.callback.url=${APP_CALLBACK_URL:http://123.60.64.142:8080/api/synthesis/callback}

# 本地文件存储配置
file.storage.local.path=${FILE_STORAGE_LOCAL_PATH:temp/audio}

# MyBatis 配置
mybatis.mapper-locations=classpath*:mapper/*.xml
mybatis.configuration.map-underscore-to-camel-case=true

# 禁用 MongoDB 监控
management.metrics.mongo.enabled=false
spring.autoconfigure.exclude=org.springframework.boot.actuate.autoconfigure.metrics.mongo.MongoMetricsAutoConfiguration

# RocketMQ 配置
# 容器内运行使用：rocketmq-namesrv:9876
# 容器外运行使用：localhost:9876
rocketmq.name-server=${ROCKETMQ_NAME_SERVER:rocketmq-namesrv:9876}

# RocketMQ Proxy端点（gRPC端口，用于5.x客户端）
# 容器内运行使用：rocketmq-proxy:8081
# 容器外运行使用：localhost:8081
rocketmq.proxy-endpoint=${ROCKETMQ_PROXY_ENDPOINT:localhost:8081}

# TTS回调消息Topic
rocketmq.tts-callback.topic=${ROCKETMQ_TTS_CALLBACK_TOPIC:TtsCallbackTopic}

# TTS回调消息Consumer Group
rocketmq.tts-callback.consumer-group=${ROCKETMQ_TTS_CALLBACK_CONSUMER_GROUP:TtsCallbackConsumerGroup}

# TTS回调消息并发处理数
rocketmq.tts-callback.consumption-thread-count=5